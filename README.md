# Plaquettes Project


**About:**

This project was carried out as part of the 3FULLBK course during the 2021-2022 academic year. The aim of this project is to provide access to a resource management backend enabling the digitization of Estiam's presentation brochures.


##Evolutions to be planned:

- Enable duplicate management for program management endpoints
- Add more advanced resource management endpoints in route files.
- Refacto to centralize access control tests in utils.js.


## Project structure


**CONTRIBUTING.md:** contains a quickstart and guidelines to help new developers get the project up and running and develop new features


**server.js:** allows you to launch the project by listening on a port; the command used to launch it will be nodemon.


**app.js:** lists the routes leading to the CRUD management endpoints for each type of resource.


**The routes:** folder contains one file per resource, listing the CRUD management endpoints.


**The models:** folder contains a model and schema definition file, for most resources: A schema is reused for several resource types when its structure can correspond to several different resources.

example: programElement is used for three different resource types.

How to test the project

rs reusable utilities in the code.


**kernel/utils.js:** this file contains token management and access control functions, as well as hard-coded admin credentials to manage the API when no other user exists or has the required rights to perform the same actions. { admUsername: 'origin', admPasswd: 'h4xx0rz!' } We strongly recommend changing these credentials to avoid hacks.


**kernel/db.js:** contains the database connection function.


**controllers/baseController.js: **the application's central controller. This central controller contains four CRUD functions used by all the application's other endpoints. Due to this design, resource management is fairly basic.


**routes/user-management/tokenRoutes.js:** contains the token management endpoints.

This file is the only one to list specific management endpoints, as opposed to the others, which simply perform the same operation.


## Database connection

Connection to the database is made when the project is launched, via the db.js file using dotenv and an associated .env file.

The project will not function without this .env file.


## Authentication

Authentication is performed via the /users/login endpoint.

Any request made without a cookie containing a token generated by an account with the necessary modifications for resource manipulation will be refused with a 401 status code. Token refresh can be performed via endpoint /users/refresh. A default administrator user is listed in the kernel/utils.js file.


## User rights management

Access management is based on 3 elements.


Permission, which consists of a string defining the resource name, and a string “W” or “R” defining whether the permission gives read or write access to the specified resource.

The role, which consists of a role name with a list of permission IDs. The role's role (lol) is to define which resources the user with this role has access to, and whether or not he can make modifications to them.

The user, with a username, password and role ID.


Note that access management is the only part of the application where the relationship between schemas is achieved via mongoose IDs.


## How are duplicates managed?

The baseController central controller contains checks to verify whether a document exists in the mongoose database before inserting new ones.

This logic works on simple mongoose schemas only.


#####Known bug: when a schema contains nested schemas (PROGRAMS CATEGORY SCHEMATICALLY), duplicate management is not effective and the new document is added even if an identical one exists in the database. Duplicate management is functional on the rest of the endpoints.
